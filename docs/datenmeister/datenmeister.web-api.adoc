= DatenMeister Web API

In addition to server-generated web pages, the DatenMeister web client also communicates with the server API, which is documented in the following section.

Each chapter describes the API of a file.

== Helper Classes

=== Helper Class ItemWithNameAndId

The helper class _ItemWithNameAndId_ (C# namespace DatenMeister.Json) functions as a transfer object from web *server* to web *client* to pass an item as a proxy without its properties. To avoid unnecessary round trips between web server and web client, the object consists of the following properties:

* name: Name of the object, as returned by NamedElementMethods.GetName
* uri: URI of the element
* extentUri: URI of the extent in which the object is located
* fullName: The full name, as returned by NamedElementMethods.GetFullName
* id: The ID of the object
* workspace: Workspace in which the element itself is located.

The object is accessible from the web server via $"{extentUri}#{id}".

=== Helper Class MofJsonObject

The helper class _MofJsonObject_ (generated via C# class MofJsonConverter) functions as a transfer object from web *client* to web *server* or from web *server* to web *client* to pass an item with all its properties and necessary meta-information.

This object is a JSON object and is processed on the client side by the method _Mof.ts::createObjectFromJson_.

* r: If the object has not been resolved by the server in the respective context, this property contains the URL of the object. Corresponds to the MofObjectShadow concept.
* v: Contains an associative array of property names to values. If the value is again a MofObject, a MofJsonObject is formed again.
* m: ItemWithNameAndId instance of the object's metaclass
* u: URL of the object

== ElementsController

This web controller differs from the 'ItemsController' in that it contains extended methods, while the ItemsController contains the typical CRUD methods (Create, Read, Update, Delete).

=== Get Name of element

* Node: api/elements/get_name/{workspace}/{extenturi}/{itemid}
** workspace: Workspace of the searched element
** extentUri: Extent of the searched element
** itemid: ID of the searched element
* Method: GET
* Body: _none_
* Return:
** name: Name of the element

*Description:*

Returns the name of the selected element. The name is selected via NamedElementMethods.GetName.

=== Get Name of Element (per Uri)

* Node: api/elements/get_name/{uri}/{workspace?}
** uri: URI of the searched element
** workspace: (Optional) Workspace of the searched element
* Method: GET
* Body: _none_
* Return:
** name: Name of the element

*Description:*

Returns the name of the selected element. The name is selected via NamedElementMethods.GetName. If no workspace is specified, the entire database is searched.

=== Get Composites

* Node: api/elements/get_composites/{workspaceId?}/{itemUrl?}
* Method: GET
** workspaceId: (Optional) Name of the selected workspace
** itemUrl: (Optional) URL of the selected elements
* Body: _none_
* Return:
** Array of _ItemWithNameAndId_ elements. These contain the name and URL of the elements.

*Description:*

Returns the sub-elements of the selected workspace or the selected item.

If no workspace was specified, the workspaces are returned. If a workspace was specified but no itemUrl, all root elements are returned; otherwise, the sub-elements are returned.

=== Find Item By SearchString

* Node: api/elements/find_by_searchstring?search=searchString
* Method: GET
** searchString: Description of the item to be searched for. This is a global search that returns either a single item or a set of items. It is the task of the client to perform the underlying, meaningful action.
* Body: _none_
* Return:
** resultType: 'reference', if a reference to an element was found. 'referenceExtent', if a reference to an extent was found. 'none', if nothing was found.
** reference: ItemWithNameAndId instance of the element which is referenced.

== ExtentController

=== Create new Xmi Extent

* Node: api/extent/create_xmi/{workspace}
** workspace: (Optional) Workspace of the searched element
* Method: POST
* Body:
** filePath: Path where the XMI is to be created
** extentUri: Name of the extent to be created
* Return:
** success: true, if the extent could be successfully created.

*Description:*

Creates a new extent at the specified file path {filePath} under the extent URL {extentUri}. This extent is a standard XMI extent.

Warning: This extent is created with the rights of the web server, and therefore this extent can be created almost anywhere in the server's file system via filePath.

=== Delete Extent

* Node: api/extent/delete
* Method: DELETE
* Body:
** workspace: Workspace of the extent to be deleted
** extentUri: Name of the extent to be deleted
* Return:
** success: true, if the extent could be successfully deleted.

*Description:*

Deletes the specified extent. The underlying data is also deleted.

== FormsController

=== Get Default Form for Item

* Node: api/forms/default_for_item/{workspaceId}/{itemUrl}/{viewMode?}
** workspaceId: Name of the workspace where the object is located
** itemUrl: URL of the item
** viewMode: (Optional) ViewMode for which the form should be retrieved
* Method: GET
* Body: _none_
* Return:
** item: The item as a _MofJson-Object_.
** metaClass: The MetaClass of the form as _ItemWithNameAndId_.

*Description:*

Retrieves the form for the selected item. If the ViewMode is also specified, it is considered by the form search. The form search itself runs via the C# class _FormFinder_. See chapter "Finding Forms".

=== Get Default Form for Extent

* Node: api/forms/default_for_extent/{workspaceId}/{extentUrl}/{viewMode?}
** workspaceId: Name of the workspace where the object is located
** extentUrl: URL of the extent
** viewMode: (Optional) ViewMode for which the form should be retrieved
* Method: GET
* Body: _none_
* Return:
** item: The item as a _MofJson-Object_.
** metaClass: The MetaClass of the form as _ItemWithNameAndId_.

*Description:*

Retrieves the form for the selected extent. If the ViewMode is also specified, it is considered by the form search. The form search itself runs via the C# class _FormFinder_. See chapter "Finding Forms".


== ItemsController

=== Create Item in Extent

* Node: api/items/create_in_extent/{workspaceId}/{extentUri}
** workspaceId: Name of the workspace where the object is located
** extentUri: URL of the extent
* Method: POST
* Body:
** metaClass: URI of the MetaClass
* Return:
** success: true, if successful
** itemId: ID of the newly created object

*Description:*

Creates a new object as a root object in the extent. Via the MetaClass, the metaclass of the newly created object can be specified.

=== Create Item as Child

* Node: api/items/create_child/{workspaceId}/{itemUri}
** workspaceId: Name of the workspace where the object is located
** itemUri: URL of the item in which the new object is created as a child
* Method: POST
* Body:
** property: Property in which the child object is created.
** asList: true, if the object should be added as a list entry. Otherwise, the element is added as a direct reference.
** metaClass: URI of the MetaClass
** properties: MofObjectAsJson which contains the properties to be set
* Return:
** success: true, if successful
** itemId: ID of the newly created object

*Description:*

Creates a new object as a child of an existing object. Via the property, the property in which the object is to be stored is specified. If the object is to be assigned directly as a property as the sole property object, _asList_ can be set to False. If the object is to be added as a list entry, then _asList_ should be set to True.

Via the MetaClass, the metaclass of the newly created object can be specified.


=== Delete Item

* Node: api/items/delete_from_extent/{workspaceId}/{extentUri}/{itemId}
** workspaceId: Name of the workspace where the object is located
** extentUri: URL of the extent
** itemId: ID of the item in which the new object is created as a child
* Method: DELETE
* Body: _none_
* Return:
** success: true, if successful

*Description:*

Deletes the object from the root of the extent.

=== Get Root Elements

* Node: api/items/get_root_elements/{workspaceId}/{extentUri}
** workspaceId: Name of the workspace where the object is located
** extentUri: URL of the extent
* Method: GET
* Parameters:
** viewNode: URL to that specific viewnode
** orderBy: Property to which the table shall be ordered
** orderByDescending: Boolean whether the property shall be ordered descending (backwards)
** filterByProperties: NOT SUPPORTED
** filterByFreetext: Additional freetext which will be used to filter items. Here, all columns will be regarded
* Body: _none_
* Return:
** item: Array of _MofJsonObject_ of the root elements

*Description:*

Lists all root elements of the selected extent.

=== Get Object

* Node: api/items/get/{workspaceId}/{extentUri}/{item}
** workspaceId: Name of the workspace where the object is located
** extentUri: URL of the extent
** itemId: ID of the item in which the new object is created as a child
* Method: GET
* Body: _none_
* Return:
** item: _MofJsonObject_ of the found object

*Description:*

Retrieves the properties of the selected object.

=== Get Parents

* Node api/items/get_container/{workspaceId}/{itemUrl}
* Method: GET
** workspaceId: Name of the selected workspace
** itemUrl: URL of the selected elements
* Body: _none_
* Return:
** Array of _ItemWithNameAndId_ elements. The first element contains the direct container, while the further elements each contain its container recursively.

*Description:*

Returns the container element of the selected element and its containers recursively. This method ends at the actual extent.

=== Set Property

* Node: api/items/set_property/{workspaceId}/{itemUri}
** workspaceId: Name of the workspace where the object is located
** itemUri: URL of the item in which the new object is created as a child
* Method: PUT
* Body:
** key: Key of the property
** value: Value of the property
* Return:
** success: true, if successful

*Description:*

Sets a property of the selected object.

=== Set Properties

* Node: api/items/set_properties/{workspaceId}/{itemUri}
** workspaceId: Name of the workspace where the object is located
** itemUri: URL of the item in which the new object is created as a child
* Method: PUT
* Body:
** Array of elements with the following properties:
*** key: Key of the property
*** value: Value of the property
* Return:
** success: true, if successful

*Description:*

Sets several properties of the selected object.

=== Set Object

* Node: api/items/set/{workspaceId}/{itemUri}
** workspaceId: Name of the workspace where the object is located
** itemUri: URL of the item in which the new object is created as a child
* Method: POST
* Body:
** _MofJsonObject_ with the properties to be set.
* Return:
** success: true, if successful

=== Get Property of Object
* Node: api/items/get_property/{workspaceId}/{itemUri}
** workspaceId: Name of the workspace where the object is found.
** itemUri: URL of the item whose property is to be loaded
* Method: GET
** property: Name of the property to be loaded.
* Return:
** v: Value of the loaded property as a MofJsonObject. This can also be an array of properties.

*Description:*

Retrieves a property of an object.

=== Add Reference To List

* Node: api/items/add_ref_to_collection/{workspaceId}/{itemUri}
** workspaceId: Name of the workspace where the object is found.
** itemUri: URL of the item to whose property a new reference is to be added.
* Method: POST
* Body:
** property: Property to which an object is to be added:
** workspaceId: Optional, the workspace where the reference is to be found.
** referenceUri: URL of the reference to be added
* return:
** success: true, if successful

Adds a new reference to a property of an object. For this purpose, the property is loaded as a collection and then the found object is added.

=== Remove Reference from list

* Node: api/items/remove_ref_to_collection/{workspaceId}/{itemUri}
** workspaceId: Name of the workspace where the object is found.
** itemUri: URL of the item from whose property a reference is to be removed.
* Method: POST
* Body:
** property: Property from which an object is to be removed:
** workspaceId: Optional, the workspace where the reference is to be found.
** referenceUri: URL of the reference to be removed
* return:
** success: true, if successful

=== SetMetaClass

* Node api/items/set_metaclass/{workspaceId}/{itemUrl}
* Method: POST
** workspaceId: Name of the selected workspace
** itemUrl: URL of the selected elements
* Body:
** metaClassUri: A link to the new metaclass
* Return:
** success: true, if successful

*Description:*

Returns the container element of the selected element and its containers recursively. This method ends at the actual extent.

== TypesController

=== Get all types

* Node: api/types/all
* Method: GET
* Body: _none_
* Return:
** Array[] of all types. Each type is represented in the structure _ItemWithNameAndId_

*Description:*

Returns a list of all known and selected types. For this, the method LocalTypeSupport.GetAllTypes() is used.

== WorkspaceController

=== Delete Workspaces

* Node: api/workspace/delete
* Method: DELETE
* Body:
** Workspace: Selected workspace
* Return:
** success: true

*Description:*

Deletes the selected workspace. This method also deletes all extents contained therein.

== ZipController

=== Create Zip Example

* Node: api/zip/create
* Method: POST
* Body:
** Workspace: Selected workspace
* Return:
** success: true
** extentUri: URI of the generated example

*Description:*

Generates a new zip example in the selected workspace.